pool:
  name: 'rhtap-testing' # The name of your pool
  demands:
    - Agent.Name -equals tssc-testing-agent-1

steps:
- script: |
    echo "Current disk usage before cleanup:"
    df -h
    
    # 1. Clean the agent's specific work directory
    # Target ONLY the work folder, not the home directory

    echo "Cleaning agent work folder: $(Agent.WorkFolder)"
    
    # We use -rf on the contents of the work folder to keep the folder itself
    cd $(Agent.HomeDirectory)
    rm -rf $(Agent.WorkFolder)/*
    
    # 2. Clean the shared Docker cache
    echo "Pruning Docker (this is usually the main issue)..."
    docker system prune -af --filter "until=12h"
    
    echo "Disk usage after cleanup:"
    df -h
  displayName: 'Emergency Agent Disk Scrub'